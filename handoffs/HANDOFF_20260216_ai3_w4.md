# HANDOFF_20260216_ai3_w4

**Date:** 2026-02-16  
**From:** AI-3 (QA/Release Cell)  
**To:** Codex (Core), Gemini (UX)  
**ID:** ai3_w4  
**Branch:** `feature/v1-ux-aiB`

---

## 1. Problem

Der QA-Stack war funktional vorhanden, aber nicht release-hart:

1. **Stale QA-Zahlen:** W2-Dokumente referenzierten veraltete Ergebnisse (vor PI-008/PI-010)
2. **Gate-Runner Robustheit unvollst√§ndig:** `gate_ui.ps1` brach bei non-zero `conda run` vor eigener Summary aus; `gate_all.ps1` hatte keine explizite Hygiene-Policy-Steuerung
3. **Release-Readiness nicht durchg√§ngig evidenzbasiert:** Fehlende konsolidierte QA-Evidence-Datei pro Lauf

---

## 2. API/Behavior Contract

### Keine neuen Core-APIs
QA-Cell Scope bleibt:
- **Allowed:** `test/**`, `roadmap_ctp/**`, `scripts/**`, `.github/workflows/**`
- **Blocked:** `modeling/**`, `gui/main_window.py`, `gui/viewport_pyvista.py`

### Contract-Update f√ºr QA
- `tnp_ref_drift` ist jetzt im Core operationalisiert und kann als `WARNING` + `status_details.code=tnp_ref_drift` auftreten
- `gate_ui.ps1` garantiert jetzt eigene Summary-Ausgabe auch bei Abbruch
- `gate_all.ps1` unterst√ºtzt `-StrictHygiene` Parameter

### Exit-Code-Vertrag
| Skript | Exit 0 | Exit 1 |
|--------|--------|--------|
| `gate_core.ps1` | PASS | FAIL/ERROR |
| `gate_ui.ps1` | PASS | FAIL/BLOCKED |
| `gate_all.ps1` | Alle Gates OK | Mindestens ein Gate FAIL |
| `hygiene_check.ps1` | CLEAN/WARNING | FAIL (nur mit `-FailOnUntracked`) |

---

## 3. Impact

### Erstellte/Ge√§nderte Dateien

| Datei | √Ñnderung | Warum |
|-------|----------|-------|
| `scripts/gate_core.ps1` | Updated | Einheitliches Ausgabeformat, Error-Parsing robuster |
| `scripts/gate_ui.ps1` | Updated | Garantierte Summary-Ausgabe auch bei conda-Fehler, BLOCKED/FAIL Unterscheidung |
| `scripts/gate_all.ps1` | Updated | `-StrictHygiene` Parameter f√ºr explizite Policy-Steuerung |
| `scripts/hygiene_check.ps1` | Updated | WARN vs FAIL klar konfigurierbar, Violation-Details mit Owner |
| `roadmap_ctp/FLAKY_BURN_DOWN_20260215.md` | Updated | Aktuelle Core-Zahlen (238 passed), UI-Blocker mit exakter Quelle |
| `roadmap_ctp/GATE_DEFINITIONS_20260215.md` | Updated | PI-010 Gate hinzugef√ºgt, aktuelle Resultate, Runner-Commands |
| `roadmap_ctp/REGRESSION_PACK_STATUS_20260215.md` | Updated | 99+20 passed, W4 Changes dokumentiert |
| `roadmap_ctp/ERROR_CODE_MAPPING_QA_20260215.md` | Updated | `tnp_ref_drift` als operationalisiert markiert, Evidence-Commands |
| `roadmap_ctp/WORKSPACE_HYGIENE_GATE_20260215.md` | Updated | Violation-Liste mit Fix-Empfehlungen und Ownern |
| `roadmap_ctp/QA_EVIDENCE_W4_20260216.md` | **NEW** | Konsolidierte Evidence-Datei mit exakten Commands und Resultaten |
| `roadmap_ctp/QA_EVIDENCE_W4_20260216.json` | **NEW** | Maschinenlesbare Evidence-Datei |
| `.github/workflows/gates.yml` | **NEW** | CI-Gate-Skeleton mit Core, PI-010, Hygiene, UI |

### Neue/Ge√§nderte Baseline

| Gate | Alt (W2) | Neu (W4) | Delta |
|------|----------|----------|-------|
| Core-Gate | 217 passed | 238 passed | +21 (PI-010) |
| PI-010 | - | 20 passed | **NEW** |
| UI-Gate | 11 errors | 11 errors | Unchanged |
| Hygiene | 7 violations | 7 violations | Unchanged |

---

## 4. Validation

### Core-Gate (W4)
```powershell
conda run -n cad_env python -m pytest -q `
    test/test_feature_error_status.py `
    test/test_tnp_v4_feature_refs.py `
    test/test_trust_gate_core_workflow.py `
    test/test_cad_workflow_trust.py `
    test/test_brepopengun_offset_api.py `
    test/test_feature_flags.py `
    test/test_tnp_stability.py `
    test/test_feature_edit_robustness.py `
    test/test_project_roundtrip_persistence.py `
    test/test_parametric_reference_modelset.py
```

**Resultat:** `238 passed, 2 skipped` ‚úÖ

**Runner-Validierung:**
```powershell
powershell -ExecutionPolicy Bypass -File scripts/gate_core.ps1
# Erwartet: Status: ‚úÖ PASS, Exit Code: 0, Duration: ~60s
```

---

### UI-Gate (W4)
```powershell
conda run -n cad_env python -m pytest -q `
    test/test_ui_abort_logic.py `
    test/harness/test_interaction_consistency.py
```

**Resultat:** `3 skipped, 11 errors` üî¥

**Runner-Validierung:**
```powershell
powershell -ExecutionPolicy Bypass -File scripts/gate_ui.ps1
# Erwartet: Status: BLOCKED, Exit Code: 1, Blocker: NameError tr not defined
```

---

### Regression-Pack + PI-010 (W4)
```powershell
# Regression-Pack (4 Suites)
conda run -n cad_env python -m pytest -q `
    test/test_feature_error_status.py `
    test/test_tnp_v4_feature_refs.py `
    test/test_project_roundtrip_persistence.py `
    test/test_feature_edit_robustness.py
# Result: 99 passed, 1 skipped

# PI-010 (Separat)
conda run -n cad_env python -m pytest -q test/test_parametric_reference_modelset.py
# Result: 20 passed
```

---

### Hygiene-Gate (W4)
```powershell
# Default (Warning)
powershell -ExecutionPolicy Bypass -File scripts/hygiene_check.ps1
# Result: 7 violations, Status: WARNING, Exit: 0

# Strict (Fail)
powershell -ExecutionPolicy Bypass -File scripts/hygiene_check.ps1 -FailOnUntracked
# Result: 7 violations, Status: FAIL, Exit: 1
```

---

### Aggregated Gate (W4)
```powershell
# Standard (Hygiene=Warning)
powershell -ExecutionPolicy Bypass -File scripts/gate_all.ps1
# Result: Core=PASS, UI=BLOCKED, Hygiene=WARNING, Overall=FAIL

# Strict (Hygiene=Fail)
powershell -ExecutionPolicy Bypass -File scripts/gate_all.ps1 -StrictHygiene
# Result: Core=PASS, UI=BLOCKED, Hygiene=FAIL, Overall=FAIL
```

---

## 5. Breaking Changes / Residual Risks

### Breaking Changes
- **Keine** - Nur Dokumentation, Runner-Skripte und CI-Skeleton

### Residual Risks
| Risiko | Wahrscheinlichkeit | Impact | Mitigation |
|--------|-------------------|--------|------------|
| UI-Gate bleibt blockiert | Hoch | Keine UI-Regression-Validierung | Gemini-Priorisierung f√ºr `tr()` Fix in `status_bar.py:126` |
| Hygiene-Violations akkumulieren | Mittel | Repository-Bloat | `scripts/hygiene_check.ps1` jetzt verf√ºgbar, Cleanup-Liste dokumentiert |
| `tnp_ref_drift` UX-L√ºcke bleibt | Niedrig | Stille Datenmigration | Core operationalisiert (W4), UI-Notification ausstehend |
| Runner-Abbruch bei zuk√ºnftigen Fehlern | Niedrig | Inkonsistente Reports | Hardening in W4 implementiert, sollte robust sein |

---

## N√§chste 5 Priorisierte Folgeaufgaben

### 1. P0: UI-Gate Infrastructure Unblock (Gemini)
**Aufgabe:** `tr()` Import in `gui/widgets/status_bar.py` fixen  
**Repro:**
```powershell
conda run -n cad_env python -m pytest test/test_ui_abort_logic.py -x
```
**Erwartet:** Keine Infrastructure Errors  
**Owner:** Gemini (UX)  
**ETA:** ASAP

---

### 2. P1: Hygiene-Cleanup Durchf√ºhrung (AI-3)
**Aufgaben:**
- `test_output.txt` und `test_output_trace.txt` l√∂schen
- `.gitignore` erweitern um `test_output*.txt`
- Debug-Dateien in `test/` reviewen (keep/move/delete)

**Repro:**
```powershell
powershell -ExecutionPolicy Bypass -File scripts/hygiene_check.ps1
# Erwartet: Status: ‚úÖ CLEAN
```
**Owner:** AI-3 (QA)  
**ETA:** 2026-02-17

---

### 3. P1: Error-Code UX-Gaps (Gemini)
**Aufgaben:**
- `tnp_ref_drift` Toast-Notification implementieren
- Error-Detail-Tooltip in TNP-Stats-Panel

**Repro:**
```powershell
grep -n "tnp_ref_drift" gui/widgets/tnp_stats_panel.py
# Erwartet: Keine GAP-Eintr√§ge mehr
```
**Owner:** Gemini (UX)  
**ETA:** 2026-02-18

---

### 4. P2: CI-Workflow Aktivierung (AI-3)
**Aufgabe:** `.github/workflows/gates.yml` testen und aktivieren  
**Repro:**
```bash
# Nach Push zu feature/v1-ux-aiB
gitHub Actions > Gates Workflow > Core-Gate muss gr√ºn sein
```
**Owner:** AI-3 (QA)  
**ETA:** 2026-02-19

---

### 5. P2: Golden-Model-Harness Vorbereitung (AI-3)
**Aufgabe:** QA-005 Vorbereitung - Referenzmodelle f√ºr visuelle Regression  
**Repro:**
```powershell
# Zuk√ºnftig:
conda run -n cad_env python -m pytest test/test_golden_models.py
# Erwartet: Visuelle Vergleiche mit referenzbildern
```
**Owner:** AI-3 (QA)  
**ETA:** 2026-02-21

---

## Referenz-Dokumente

Alle Artefakte befinden sich in:
- `roadmap_ctp/FLAKY_BURN_DOWN_20260215.md`
- `roadmap_ctp/GATE_DEFINITIONS_20260215.md`
- `roadmap_ctp/REGRESSION_PACK_STATUS_20260215.md`
- `roadmap_ctp/ERROR_CODE_MAPPING_QA_20260215.md`
- `roadmap_ctp/WORKSPACE_HYGIENE_GATE_20260215.md`
- `roadmap_ctp/QA_EVIDENCE_W4_20260216.md`
- `roadmap_ctp/QA_EVIDENCE_W4_20260216.json`
- `scripts/gate_core.ps1`
- `scripts/gate_ui.ps1`
- `scripts/gate_all.ps1`
- `scripts/hygiene_check.ps1`
- `.github/workflows/gates.yml`

---

**End of Handoff AI-3 W4**

---

## 6. Core Sync Delta (Post W4, √ºbernommen aus Core W6/W8)

Dieses Addendum synchronisiert den QA-Handoff mit dem aktuellen Core-Stand nach
`handoffs/HANDOFF_20260216_core_to_ai3_w6.md` und
`handoffs/HANDOFF_20260216_core_to_gemini_w8.md`.

### Delta zum W4-Stand
- Core-Gate-Baseline ist nicht mehr `238 passed, 2 skipped`, sondern:
  - `242 passed, 2 skipped` (erweiterter Core-Gate-Lauf)
- `tnp_ref_drift` gilt jetzt nicht nur f√ºr Edge-Recovery, sondern auch f√ºr
  single-face `single_ref_pair` Konflikte bei schwacher Shape-Aufl√∂sung
  (`geometric|geometry_hash`), mit index-preferred Verhalten.

### Neue Core-Regressionen (f√ºr QA-Tracking verpflichtend)
- `test_resolve_feature_faces_single_ref_pair_geometric_conflict_prefers_index`
- `test_safe_operation_emits_drift_warning_for_single_ref_pair_geometric_face_conflict`

### Aktualisierte Evidence-Werte (erg√§nzend zu Abschnitt 4)
- Targeted (Face+Edge drift single_ref_pair): `4 passed`
- Regression-Pack+ (inkl. PI-010): `123 passed, 1 skipped`
- Expanded Core-Gate: `242 passed, 2 skipped`

### QA-Folgepflichten (AI-3)
1. Rebaseline in den Roadmap-Artefakten auf `242 passed, 2 skipped`.
2. Drift-Evidence um `reference_kind=face` erg√§nzen (nicht nur edge/fallback).
3. Gate-Runner-Ausgabe pr√ºfen, dass `tnp_ref_drift`-Warnf√§lle nicht als ERROR klassifiziert werden.
