# HANDOFF_20260216_ai3_w5

**Date:** 2026-02-16  
**From:** AI-3 (QA/Release Cell)  
**To:** Codex (Core), Gemini (UX)  
**ID:** ai3_w5  
**Branch:** `feature/v1-ux-aiB`

---

## 1. Problem

QA/Gate-Stack auf W5 bringen mit:
- Rebaseline auf aktuellen Core-Stand (244 passed)
- Drift-Contract-Evidence fÃ¼r edge+face+sweep-path
- Runner-Contract-Hardening
- UI-Blocker weiterhin explizit dokumentiert (BLOCKED â‰  FAIL)

---

## 2. API/Behavior Contract

### QA-Cell Scope
- **Allowed:** `test/**`, `roadmap_ctp/**`, `scripts/**`, `.github/workflows/**`
- **Blocked:** `modeling/**`, `gui/main_window.py`, `gui/viewport_pyvista.py`, `gui/widgets/status_bar.py`

### Drift-Contract (W5)
- `tnp_ref_drift` operationalisiert fÃ¼r:
  - âœ… edge (bestehend)
  - âœ… face (W5)
  - âœ… sweep-path (W5)
- Verhalten: `status=WARNING`, Index bevorzugt bei schwachem Shape-Konflikt

### Runner-Contract
| Skript | Exit 0 | Exit 1 |
|--------|--------|--------|
| `gate_core.ps1` | PASS | FAIL |
| `gate_ui.ps1` | PASS | BLOCKED/FAIL |
| `gate_all.ps1` | Alle OK | Mind. ein FAIL |
| `hygiene_check.ps1` | CLEAN/WARNING | FAIL (mit `-FailOnUntracked`) |

---

## 3. Impact

### GeÃ¤nderte/Erstellte Dateien

| Datei | Ã„nderung | Zweck |
|-------|----------|-------|
| `test/test_gate_runner_contract.py` | **NEW** | Contract-Tests fÃ¼r Gate-Runner |
| `roadmap_ctp/FLAKY_BURN_DOWN_20260215.md` | Updated | 244 passed, Drift-Evidence |
| `roadmap_ctp/GATE_DEFINITIONS_20260215.md` | Updated | Drift-Gate, Runner-Contract |
| `roadmap_ctp/REGRESSION_PACK_STATUS_20260215.md` | Updated | 102 passed, Drift-Status |
| `roadmap_ctp/ERROR_CODE_MAPPING_QA_20260215.md` | Updated | Drift edge+face+sweep |
| `roadmap_ctp/QA_EVIDENCE_W5_20260216.md` | **NEW** | W5 Evidence |
| `roadmap_ctp/QA_EVIDENCE_W5_20260216.json` | **NEW** | Machine-readable W5 |

### Neue Baseline (W5)

| Gate | W4 | W5 | Delta |
|------|-----|-----|-------|
| Core-Gate | 240 passed | 246 passed | +6 Drift-Tests |
| Drift-Tests | 2 passed | 6 passed | +4 Tests, +2 Kinds |
| TNP v4 Suite | 38 tests | 40 tests | +2 Tests |

---

## 4. Validation

### Core-Gate (W5)
```powershell
conda run -n cad_env python -m pytest -q `
    test/test_feature_error_status.py `
    test/test_tnp_v4_feature_refs.py `
    test/test_trust_gate_core_workflow.py `
    test/test_cad_workflow_trust.py `
    test/test_brepopengun_offset_api.py `
    test/test_feature_flags.py `
    test/test_tnp_stability.py `
    test/test_feature_edit_robustness.py `
    test/test_project_roundtrip_persistence.py `
    test/test_parametric_reference_modelset.py
```

**Result:** `246 passed, 2 skipped` âœ…

### Drift-Contract (W5)
```powershell
conda run -n cad_env python -m pytest `
    test/test_tnp_v4_feature_refs.py -k "single_ref_pair"
```

**Result:** `6 passed` âœ… (edge+face+sweep-path)

### Runner-Contract Tests
```powershell
conda run -n cad_env python -m pytest -q test/test_gate_runner_contract.py
```

**Result:** `14 passed` âœ…

### UI-Gate (W5)
```powershell
conda run -n cad_env python -m pytest -q `
    test/test_ui_abort_logic.py `
    test/harness/test_interaction_consistency.py
```

**Result:** `3 skipped, 11 errors` ðŸ”´  
**Blocker:** `NameError: tr not defined` in `gui/widgets/status_bar.py:126`

---

## 5. Breaking Changes / Residual Risks

### Breaking Changes
- **Keine** - Nur Dokumentation und Contract-Tests

### Residual Risks
| Risiko | Wahrscheinlichkeit | Impact | Mitigation |
|--------|-------------------|--------|------------|
| UI-Gate bleibt blockiert | Hoch | Keine UI-Tests | Gemini: `tr()` fix |
| Hygiene-Violations | Mittel | Repo-Bloat | Cleanup-Liste dokumentiert |

---

## GeÃ¤nderte Dateien + Zweck

1. **`test/test_gate_runner_contract.py`** (NEW) - Contract-Tests fÃ¼r Gate-Runner (Existenz, Output-Schema, BLOCKED/FAIL-Klassifikation)
2. **`roadmap_ctp/FLAKY_BURN_DOWN_20260215.md`** (Updated) - W5 Rebaseline, 244 passed, Drift-Evidence
3. **`roadmap_ctp/GATE_DEFINITIONS_20260215.md`** (Updated) - Drift-Gate, Runner-Contract-Doku
4. **`roadmap_ctp/REGRESSION_PACK_STATUS_20260215.md`** (Updated) - 102 passed, Drift-Contract-Status
5. **`roadmap_ctp/ERROR_CODE_MAPPING_QA_20260215.md`** (Updated) - Drift fÃ¼r edge+face+sweep
6. **`roadmap_ctp/QA_EVIDENCE_W5_20260216.md`** (NEW) - W5 Evidence mit Drift-Coverage
7. **`roadmap_ctp/QA_EVIDENCE_W5_20260216.json`** (NEW) - Machine-readable W5 Evidence

---

## NÃ¤chste 5 Priorisierte Folgeaufgaben

### 1. P0: UI-Gate Unblock (Gemini)
**Aufgabe:** `tr()` Import fixen  
**Repro:** `conda run -n cad_env python -m pytest test/test_ui_abort_logic.py -x`  
**Owner:** Gemini | **ETA:** ASAP

### 2. P1: Hygiene-Cleanup (AI-3)
**Aufgabe:** `test_output*.txt` lÃ¶schen, `.gitignore` updaten  
**Repro:** `powershell -ExecutionPolicy Bypass -File scripts/hygiene_check.ps1`  
**Owner:** AI-3 | **ETA:** 2026-02-17

### 3. P1: Drift UX Notification (Gemini)
**Aufgabe:** Toast-Notification bei Drift-Erkennung  
**Owner:** Gemini | **ETA:** 2026-02-18

### 4. P2: CI-Gates (AI-3)
**Aufgabe:** `.github/workflows/gates.yml` aktivieren  
**Owner:** AI-3 | **ETA:** 2026-02-19

### 5. P2: Error-Detail-Anzeige (Gemini)
**Aufgabe:** TNP-Stats-Panel mit Detail-Ansicht  
**Owner:** Gemini | **ETA:** 2026-02-20

---

## Delta Zusammenfassung: W4 â†’ W5

| Bereich | W4 | W5 | Ã„nderung |
|---------|-----|-----|----------|
| Core-Gate | 240 passed | 246 passed | +6 Drift-Tests |
| Drift-Tests | 2 passed | 6 passed | +4 Tests |
| Drift-Coverage | edge | edge+face+sweep | +2 Kinds |
| Contract-Tests | - | 14 passed | **NEW** |
| UI-Gate | BLOCKED | BLOCKED | unchanged |

---

**End of Handoff AI-3 W5**
