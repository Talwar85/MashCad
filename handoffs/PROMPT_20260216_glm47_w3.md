# PROMPT_20260216_glm47_w3

Du bist `glm 4.7` als QA/Release Cell auf Branch `feature/v1-ux-aiB`.
AI-3 ist pausiert. Du uebernimmst ab hier vollstaendig den QA/Release-Track.

## Kontext (Pflicht, zuerst lesen)
1. `handoffs/HANDOFF_20260216_glm47_w1.md`
2. `handoffs/HANDOFF_20260216_glm47_w2.md`
3. `handoffs/HANDOFF_20260216_core_to_ai3_w9.md`
4. `handoffs/HANDOFF_20260216_core_to_gemini_w11.md`
5. `handoffs/HANDOFF_20260216_gemini_w5.md`
6. `roadmap_ctp/GATE_DEFINITIONS_20260215.md`
7. `roadmap_ctp/QA_EVIDENCE_W5_20260216.md`
8. `roadmap_ctp/ERROR_CODE_MAPPING_QA_20260215.md`

## Harte Regeln
1. Keine Edits in:
- `modeling/**`
- `gui/main_window.py`
- `gui/viewport_pyvista.py`
- `gui/widgets/status_bar.py`

2. Fokusbereiche:
- `scripts/**`
- `roadmap_ctp/**`
- QA-nahe `test/**`
- `.github/workflows/**`
- `handoffs/**`

3. Keine Aussage ohne Repro-Command + Resultat.
4. Keine Dummy-Doku, keine Platzhalter.

---

## Zielbild W3
Release-harter QA-Layer mit:
- konsistenter Rebaseline auf den neuesten Stand
- belastbaren Runner-Contracts (inkl. Crash/Access-Violation Klassifizierung)
- reproduzierbarer Evidence-Generierung (md + json)
- klaren Go/No-Go Regeln fuer Core/UI/Hygiene

---

## Aufgaben (umfangreich, Reihenfolge bindend)

### WP1 (P0): W3 Rebaseline ueber alle QA-Artefakte
Aktualisiere konsistent:
- `roadmap_ctp/GATE_DEFINITIONS_20260215.md`
- `roadmap_ctp/REGRESSION_PACK_STATUS_20260215.md`
- `roadmap_ctp/FLAKY_BURN_DOWN_20260215.md`
- `roadmap_ctp/ERROR_CODE_MAPPING_QA_20260215.md`
- `roadmap_ctp/WORKSPACE_HYGIENE_GATE_20260215.md`

Pflichten:
1. Alle veralteten Werte (z. B. 240/244) auf den neuesten validierten Stand ziehen.
2. Drift-Coverage explizit fuer edge/face/sweep-path/sweep-profile aktualisieren.
3. Inkonsistenzen zwischen Dokumenten entfernen (eine Wahrheit, keine divergenten Zahlen).
4. Neue Sektion: `Delta since W2` mit konkreten Aenderungen.

---

### WP2 (P0): Gate-Runner erweitern fuer Crash/Infra-Klassifikation
Arbeite an:
- `scripts/gate_core.ps1`
- `scripts/gate_ui.ps1`
- `scripts/gate_all.ps1`

Pflichten:
1. Windows Fatal Errors (z. B. `access violation`) explizit klassifizieren:
- `BLOCKED_INFRA` (statt unklar FAIL)
2. Einheitliches Output-Schema erzwingen:
- Duration
- pass/fail/skip/error
- status
- exit code
- blocker_type (falls vorhanden)
3. `gate_all.ps1` muss in Summary klar zeigen:
- Core PASS/FAIL
- UI PASS/FAIL/BLOCKED_INFRA
- Hygiene CLEAN/WARNING/FAIL
4. Runner duplizierte Parsing-Logik konsolidieren (shared helper function in Script).

---

### WP3 (P0): Evidence-Generator auf W3-Niveau bringen
Arbeite an:
- `scripts/generate_gate_evidence.ps1`

Pflichten:
1. W3 Output-Dateien:
- `roadmap_ctp/QA_EVIDENCE_W6_20260216.md`
- `roadmap_ctp/QA_EVIDENCE_W6_20260216.json`
2. JSON-Schema erweitern:
- `status_class` (PASS/FAIL/BLOCKED_INFRA/WARNING)
- `blocker_signature`
- `command_hash` (optional, aber bevorzugt)
3. MD muss enthalten:
- Executive Summary
- Gate-Tabelle
- Root-Blocker inkl. erste betroffene Testdatei
- Kurzempfehlung je Blocker
4. Generator soll auch dann liefern, wenn ein Gate crasht (best effort, kein early abort).

---

### WP4 (P0): Runner Contract Tests erweitern
Arbeite an:
- `test/test_gate_runner_contract.py`

Pflichten:
1. Contract-Tests fuer:
- Standard PASS output
- BLOCKED_INFRA output
- FAIL output
2. Tests fuer Evidence-Generator-Output (mindestens Schluesselfelder in JSON).
3. Keine teuren End-to-End-Laeufe in Unit-Tests; nur contract-level.

---

### WP5 (P1): UI-Gate Triage-Programm (QA-seitig)
Neu erstellen:
- `roadmap_ctp/UI_GATE_TRIAGE_W3_20260216.md`

Pflichten:
1. Klare Trennung:
- Infrastrukturblocker
- Logikfehler
- potenzielle Test-Harness-Probleme
2. Fuer jeden Blocker:
- reproducible command
- observed signature
- owner (`Gemini` vs `Core` vs `QA`)
- severity
3. Kein Code in UI-Core-Dateien aendern; nur QA-Analyse + Repro.

---

### WP6 (P1): Hygiene operational abschliessen
Arbeite an:
- `roadmap_ctp/WORKSPACE_HYGIENE_GATE_20260215.md`
- optional `.gitignore`

Pflichten:
1. Jede aktuelle Violation mit Entscheidung und Frist.
2. SLA definieren (z. B. max offene Violations auf Release-Branch).
3. Wenn `.gitignore` geaendert wird: nur klar begruendete generated artefacts.

---

### WP7 (P1): CI-Gates robust machen
Arbeite an:
- `.github/workflows/gates.yml`

Pflichten:
1. Jobs:
- core-gate
- ui-gate
- hygiene-gate
- evidence
2. Artifacts hochladen:
- Gate Logs
- Evidence md/json
3. Job summary (`GITHUB_STEP_SUMMARY`) mit klarer Statusklassifikation.
4. Kein stilles Gruen bei BLOCKED_INFRA.

---

### WP8 (P2): Release-Dashboard Snapshot
Neu erstellen:
- `roadmap_ctp/RELEASE_READINESS_SNAPSHOT_W3_20260216.md`

Inhalt:
1. Gate-Status-Matrix G0-G7 (go/no-go aktuell)
2. Top-5 Blocker fuer V1
3. Nächste 2-Wochen Priorisierung
4. Datenquelle: nur reproduzierbare Evidence, keine Schaetzwerte ohne Beleg

---

## Pflicht-Validierung (vollstaendig ausfuehren)
```powershell
conda run -n cad_env python -m pytest -q test/test_parametric_reference_modelset.py
conda run -n cad_env python -m pytest -q test/test_feature_error_status.py test/test_tnp_v4_feature_refs.py test/test_trust_gate_core_workflow.py test/test_cad_workflow_trust.py test/test_brepopengun_offset_api.py test/test_feature_flags.py test/test_tnp_stability.py test/test_feature_edit_robustness.py test/test_project_roundtrip_persistence.py test/test_parametric_reference_modelset.py test/test_feature_commands_atomic.py
conda run -n cad_env python -m pytest -q test/test_ui_abort_logic.py test/harness/test_interaction_consistency.py
conda run -n cad_env python -m pytest -q test/test_gate_runner_contract.py
powershell -ExecutionPolicy Bypass -File scripts/gate_core.ps1
powershell -ExecutionPolicy Bypass -File scripts/gate_ui.ps1
powershell -ExecutionPolicy Bypass -File scripts/gate_all.ps1
powershell -ExecutionPolicy Bypass -File scripts/gate_all.ps1 -StrictHygiene
powershell -ExecutionPolicy Bypass -File scripts/hygiene_check.ps1
powershell -ExecutionPolicy Bypass -File scripts/hygiene_check.ps1 -FailOnUntracked
powershell -ExecutionPolicy Bypass -File scripts/generate_gate_evidence.ps1
powershell -ExecutionPolicy Bypass -File scripts/generate_gate_evidence.ps1 -StrictHygiene
```

## Rueckgabeformat
Datei:
- `handoffs/HANDOFF_20260216_glm47_w3.md`

Struktur:
1. Problem
2. API/Behavior Contract
3. Impact
4. Validation
5. Breaking Changes / Rest-Risiken

Zusatzpflicht:
- Read Acknowledgement (8 Quellen, je 1 Kernpunkt)
- Liste geaenderter Dateien + Zweck (1 Satz)
- Naechste 5 priorisierte Folgeaufgaben mit Owner + ETA
- Delta-Sektion gegen W2
