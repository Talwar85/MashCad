# PROMPT_20260216_ai3_w5

Du bist AI-3 (QA/Release Cell) auf Branch `feature/v1-ux-aiB`.

## Kontext (zuerst lesen)
- `handoffs/HANDOFF_20260216_ai3_w4.md`
- `handoffs/HANDOFF_20260216_core_to_ai3_w6.md`
- `handoffs/HANDOFF_20260216_core_to_gemini_w8.md`
- `handoffs/HANDOFF_20260216_glm47_w1.md`
- `roadmap_ctp/ERROR_CODE_MAPPING_QA_20260215.md`

## Harte Regeln
1. Keine Edits in:
- `modeling/**`
- `gui/main_window.py`
- `gui/viewport_pyvista.py`
- `gui/widgets/status_bar.py`

2. Fokusbereiche:
- `scripts/**`
- `roadmap_ctp/**`
- QA-nahe `test/**`
- optional `.github/workflows/**`
- `handoffs/**`

3. Keine Aussagen ohne Repro-Command + Ergebnis.
4. Keine Platzhalter oder reine TODO-Texte.

## Ziel
QA/Gate-Schicht auf W5 bringen: reproduzierbar, evidenzbasiert, rebaselined auf den aktuellen Core-Stand mit Drift-Abdeckung für edge+face+sweep-path.

## Aufgaben (Reihenfolge bindend)

### WP1 (P0): Rebaseline aller QA-Artefakte
Aktualisiere:
- `roadmap_ctp/GATE_DEFINITIONS_20260215.md`
- `roadmap_ctp/REGRESSION_PACK_STATUS_20260215.md`
- `roadmap_ctp/FLAKY_BURN_DOWN_20260215.md`
- `roadmap_ctp/ERROR_CODE_MAPPING_QA_20260215.md`
- `roadmap_ctp/WORKSPACE_HYGIENE_GATE_20260215.md`

Pflichten:
1. Alte 238/240-Zahlen entfernen, auf aktuellen Stand rebaselinen.
2. Drift-Contract explizit nachweisen für:
- edge single_ref_pair weak conflict
- face single_ref_pair weak conflict
- sweep-path single_ref_pair weak conflict
3. Blocker-Status UI weiterhin explizit halten (BLOCKED != FAIL).
4. Delta-Sektion "W4 -> W5" ergänzen.

---

### WP2 (P0): Evidence konsolidieren (MD + JSON)
Erzeuge/aktualisiere:
- `roadmap_ctp/QA_EVIDENCE_W5_20260216.md`
- `roadmap_ctp/QA_EVIDENCE_W5_20260216.json`

Pflichten:
1. Exakte Commands + Exits + Dauer + Ergebnisse.
2. Toolchain-Header (Branch, Python/pytest-Version, Timestamp).
3. Blocker-Klassifikation:
- Infrastructure blocked
- Logic fail
4. Signaturzeile wie in W4/W1 beibehalten, aber mit W5-Werten.

---

### WP3 (P0): Runner-Contract prüfen und dokumentieren
Prüfe und härte falls nötig:
- `scripts/gate_core.ps1`
- `scripts/gate_ui.ps1`
- `scripts/gate_all.ps1`
- `scripts/hygiene_check.ps1`

Pflichten:
1. Einheitliches Output-Schema (Status, Exit, Duration, counts).
2. `gate_ui.ps1` muss bei `conda run` Fehlern weiterhin strukturierte Summary ausgeben.
3. `gate_all.ps1 -StrictHygiene` klar dokumentieren (Exit-Contract).
4. Dokumentiere den Runner-Contract in `roadmap_ctp/GATE_DEFINITIONS_20260215.md`.

---

### WP4 (P1): QA-Contract-Tests ergänzen
Neu:
- `test/test_gate_runner_contract.py`

Scope:
1. Existenz/Callability der Gate-Skripte.
2. Minimale Output-Contract-Prüfung (regex/key presence für Status/Exit/Duration).
3. BLOCKED-vs-FAIL Klassifikation anhand Sample-Outputs oder kontrollierter Runner-Ausgabe.

Hinweis:
- Keine teuren End-to-End-Läufe in diesen Contract-Tests.

---

### WP5 (P1): Hygiene-Policy operationalisieren
Pflichten:
1. Cleanup-Liste pro Violation mit owner + action (`keep|delete|move|ignore`).
2. Warn/Fail-Modus glasklar dokumentieren.
3. optional: `.gitignore` Empfehlung für generierte Test-Ausgaben (`test_output*.txt`) begründen.

---

### WP6 (P2, optional): CI-Gates belastbar machen
Arbeit an:
- `.github/workflows/gates.yml`

Pflichten:
1. Jobs: core/ui/hygiene + artifact upload.
2. BLOCKED-Semantik für UI im Summary sichtbar.
3. Keine stillen grünen Builds bei echten Gate-Fehlern.

## Pflicht-Validierung
```powershell
conda run -n cad_env python -m pytest -q test/test_parametric_reference_modelset.py
conda run -n cad_env python -m pytest -q test/test_feature_error_status.py test/test_tnp_v4_feature_refs.py test/test_trust_gate_core_workflow.py test/test_cad_workflow_trust.py test/test_brepopengun_offset_api.py test/test_feature_flags.py test/test_tnp_stability.py test/test_feature_edit_robustness.py test/test_project_roundtrip_persistence.py test/test_parametric_reference_modelset.py
conda run -n cad_env python -m pytest -q test/test_ui_abort_logic.py test/harness/test_interaction_consistency.py
conda run -n cad_env python -m pytest -q test/test_gate_runner_contract.py
powershell -ExecutionPolicy Bypass -File scripts/gate_core.ps1
powershell -ExecutionPolicy Bypass -File scripts/gate_ui.ps1
powershell -ExecutionPolicy Bypass -File scripts/gate_all.ps1
powershell -ExecutionPolicy Bypass -File scripts/gate_all.ps1 -StrictHygiene
powershell -ExecutionPolicy Bypass -File scripts/hygiene_check.ps1
powershell -ExecutionPolicy Bypass -File scripts/hygiene_check.ps1 -FailOnUntracked
```

## Rückgabeformat
Datei:
- `handoffs/HANDOFF_20260216_ai3_w5.md`

Struktur:
1. Problem
2. API/Behavior Contract
3. Impact
4. Validation
5. Breaking Changes / Rest-Risiken

Zusatzpflicht:
- geänderte Dateien + Zweck
- nächste 5 priorisierte Folgeaufgaben mit Owner+ETA
- klare Delta-Zusammenfassung gegen W4
