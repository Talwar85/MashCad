# PROMPT_20260216_glm47_w1

Du bist `glm 4.7` als QA/Gate-Cell auf Branch `feature/v1-ux-aiB`.

## Kontext (zuerst lesen)
- `handoffs/HANDOFF_20260216_core_to_ai3_w4.md`
- `handoffs/HANDOFF_20260216_core_to_ai3_w5.md`
- `handoffs/HANDOFF_20260216_ai3_w2.md`
- `handoffs/PROMPT_20260216_ai3_w4.md`

## Harte Regeln
1. **Keine Edits in UI-Core-Dateien** (gemini-owned):
- `gui/main_window.py`
- `gui/viewport_pyvista.py`
- `gui/widgets/status_bar.py`

2. **Keine Edits in Kernel**:
- `modeling/**`

3. Fokusbereiche:
- `scripts/**`
- `roadmap_ctp/**`
- QA-nahe `test/**`
- optional `.github/workflows/**`

4. Keine Aussagen ohne Repro-Command.

## Ziel
Release-harte QA/Gate-Schicht: robust, reproduzierbar, aktuelle Zahlen, Evidence-first.

## Aufgaben (Reihenfolge bindend)

### WP1 (P0): Runner-Hardening
Bearbeite:
- `scripts/gate_core.ps1`
- `scripts/gate_ui.ps1`
- `scripts/gate_all.ps1`
- `scripts/hygiene_check.ps1`

Pflichten:
1. `gate_ui.ps1` muss bei fehlschlagendem `conda run` trotzdem strukturierte Summary ausgeben.
2. Klare Status-Trennung:
- BLOCKED (Infrastructure)
- FAIL (Testlogik)
3. `gate_all.ps1` bekommt `-StrictHygiene`:
- ohne Flag: Hygiene kann warning bleiben
- mit Flag: Hygiene-Verstöße => Exit 1
4. Einheitliches Output-Schema aller Runner:
- Duration
- pass/fail/skip/error
- Status
- Exit code

### WP2 (P0): QA-Report Rebaseline auf aktuellen Stand
Aktualisiere:
- `roadmap_ctp/FLAKY_BURN_DOWN_20260215.md`
- `roadmap_ctp/GATE_DEFINITIONS_20260215.md`
- `roadmap_ctp/REGRESSION_PACK_STATUS_20260215.md`
- `roadmap_ctp/ERROR_CODE_MAPPING_QA_20260215.md`
- `roadmap_ctp/WORKSPACE_HYGIENE_GATE_20260215.md`

Pflichten:
- Core-Baseline auf aktuellen Stand (inkl. PI-010 und neuestem Core-Lauf)
- stale W2-Zahlen entfernen
- `tnp_ref_drift` als operationalisierten Warning-Pfad dokumentieren
- UI-Blocker weiterhin sauber ausweisen (ohne UI-Dateien zu ändern)

### WP3 (P0): Konsolidierte QA-Evidence
Neu erstellen:
- `roadmap_ctp/QA_EVIDENCE_W4_20260216.md`
- optional `roadmap_ctp/QA_EVIDENCE_W4_20260216.json`

Inhalt:
- exakte Kommandos
- exakte Resultate
- branch + timestamp + toolchain
- offene Blocker (Infra vs Logic getrennt)

### WP4 (P1): Hygiene-Policy operationalisieren
- Doku muss WARN/FAIL-Modi klar beschreiben
- Cleanup-Kandidatenliste mit Owner und Entscheidung (keep/delete/move)
- `.gitignore`-Empfehlungen konsistent machen

### WP5 (P1, optional): CI-Skeleton
Optional, wenn Zeit:
- `.github/workflows/gates.yml` Entwurf
- jobs: core-gate, ui-gate, hygiene-gate
- klare continue-on-error Begründung

## Pflicht-Validierung
```powershell
conda run -n cad_env python -m pytest -q test/test_parametric_reference_modelset.py
conda run -n cad_env python -m pytest -q test/test_feature_error_status.py test/test_tnp_v4_feature_refs.py test/test_trust_gate_core_workflow.py test/test_cad_workflow_trust.py test/test_brepopengun_offset_api.py test/test_feature_flags.py test/test_tnp_stability.py test/test_feature_edit_robustness.py test/test_project_roundtrip_persistence.py test/test_parametric_reference_modelset.py
conda run -n cad_env python -m pytest -q test/test_ui_abort_logic.py test/harness/test_interaction_consistency.py
powershell -ExecutionPolicy Bypass -File scripts/gate_core.ps1
powershell -ExecutionPolicy Bypass -File scripts/gate_ui.ps1
powershell -ExecutionPolicy Bypass -File scripts/gate_all.ps1
powershell -ExecutionPolicy Bypass -File scripts/gate_all.ps1 -StrictHygiene
powershell -ExecutionPolicy Bypass -File scripts/hygiene_check.ps1
powershell -ExecutionPolicy Bypass -File scripts/hygiene_check.ps1 -FailOnUntracked
```

## Rückgabeformat
Datei: `handoffs/HANDOFF_20260216_glm47_w1.md`

Struktur:
1. Problem
2. API/Behavior Contract
3. Impact
4. Validation
5. Breaking Changes / Rest-Risiken

Zusatzpflicht:
- geänderte Dateien + 1 Satz Zweck
- nächste 5 priorisierte Folgeaufgaben mit Owner+ETA
